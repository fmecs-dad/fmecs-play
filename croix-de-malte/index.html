<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Morpion Solitaire ‚Äì Croix de Malte</title>
  <link rel="preload" as="image" href="images/monfond.jpg">
  <link rel="stylesheet" href="css/style.css">
  <link rel="icon" type="image/png" href="favicon.png?v=1">
</head>

<body>

<!-- Modale "Vous n'√™tes pas connect√© / inscrit" -->
<div id="whySignupModal" class="overlay overlay-center hidden">
  <div class="panel">
    <h2>Vous n'√™tes pas connect√© / inscrit</h2>
    <p>En cr√©ant un compte, vous pourrez :</p>
    <ul style="text-align:left; max-width:360px; margin:0 auto 16px;">
      <li>Enregistrer vos meilleurs scores</li>
      <li>Appara√Ætre dans le leaderboard</li>
      <li>Associer un pseudo et un avatar</li>
    </ul>

    <!-- Case √† cocher pour accepter la politique de confidentialit√© (RGPD) -->
    <div style="margin: 12px 0; font-size: 14px;">
      <label class="privacy-label">
        <input type="checkbox" id="acceptPrivacyPolicy" required />
        J‚Äôaccepte la <a href="https://fmecs.fr/politique-de-confidentialite.html" target="_blank" class="privacy-link">politique de confidentialit√©</a>.
      </label>
    </div>

    <div style="margin: 12px 0;">
      <label style="font-size: 14px;">
        <input type="checkbox" id="whySignupDontRemind" />
        Ne plus me le rappeler
      </label>
    </div>

    <div style="margin-top: 16px; display: flex; gap: 10px; justify-content: center;">
      <button id="whySignupRegisterBtn" class="main-btn" disabled>S‚Äôinscrire</button>
      <button id="whySignupContinueBtn" class="main-btn">Continuer sans compte</button>
    </div>
  </div>
</div>

<!-- Modale "Pr√™t √† jouer ?" -->
<div id="readyModal" class="overlay overlay-center hidden">
  <div class="panel">
    <p>Pr√™t √† jouer ?</p>
    <img src="images/jeton.png" alt="Jeton FmecS" class="jeton-img">
    <button id="readyBtn" class="main-btn">Commencer</button>
  </div>
</div>

<!-- Modale pseudo -->
<div id="signupModal" class="overlay overlay-center hidden">
  <div class="panel">
    <h2>Cr√©er votre pseudo</h2>
    <input id="signupPseudoInput" type="text" placeholder="Votre pseudo" class="modal-input">
    <button id="signupConfirmBtn" class="main-btn">Enregistrer</button>
    <button id="signupCloseBtn" class="close-btn">‚úï</button>
  </div>
</div>


<!-- === HELP OVERLAY === -->
<div id="helpOverlay" class="overlay overlay-center hidden">
    <div class="panel">
    <button class="close-btn" id="closeHelpBtn">‚úï</button>

    <h2>üìñ Aide - pour bien d√©marrer</h2>
    <div class="aide-separator"></div>

    <h3>L‚Äôobjectif</h3>
    <p>Tracer un maximum de lignes de 5 points en partant de la Croix de Malte avec les points noirs actifs.</p>
    <div class="aide-separator"></div>

    <h3>Comment jouer</h3>
    <ul>
      <li>Rep√®re une ligne possible de 5 points align√©s avec un minimum de 4 points d√©j√† actifs.</li>
      <li>Clique sur l‚Äôun des points d‚Äôextr√©mit√©, puis sur le point d‚Äôarriv√©e.</li>
      <li>La ligne sera cr√©√©e automatiquement si elle est valide.</li>
      <li>Le bouton Retour permet d'annuler la derni√®re ligne cr√©√©e.</li>
      <li>Le bouton Pause arr√™te le chrono.</li>
      <li>Le menu Burger ‚ò∞ permet d'acc√©der au Pas √† Pas montrant comment cr√©er des lignes.</li>
      <li>Retrouve-moi aussi dans ce menu ‚ò∞ ainsi que d'autres options</li>
    </ul>
    <div class="aide-separator"></div>

    <h3>R√®gles</h3>
    <ul>
      <li>Une ligne doit faire exactement 5 points.</li>
      <li>Une ligne doit contenir au pr√©alable au moins 2 points d√©j√† actifs.</li>
      <li>Les lignes peuvent se croiser, mais pas se superposer.</li>
    </ul>
    <div class="aide-separator"></div>

    <h3>Jokers</h3>
    <p>Gagn√©s lorsqu‚Äôune ligne utilise 5 points d√©j√† actifs.</p>
    <p><strong>Utilisation :</strong></p>
    <ul>
      <li>1 joker utilis√© si la ligne comporte seulement 3 points actifs.</li>
      <li>2 jokers utilis√©s si elle ne comporte que 2 points actifs.</li>
      <li><em>Les lignes avec moins de 2 points actifs ne sont pas autoris√©es.</em></li>
    </ul>
  </div>
</div>

  <div id="gameContainer">

<!-- === TOP BAR === -->
<div id="topBar">
  <!-- Bloc 1 : Burger -->
  <div id="burgerWrapper">
    <button id="burgerBtn" class="burger-btn" aria-label="Menu">‚ò∞</button>
  </div>

  <!-- Bloc 2 : Titre -->
  <div id="titleArea">
    <h1>Morpion Solitaire ‚Äì Croix de Malte</h1>
    <div id="subtitle">
      Objectif : cr√©er des lignes de 5 points selon les r√®gles du Morpion Solitaire
    </div>
  </div>

  <!-- Bloc 3 : Valeurs -->
  <div id="statusArea">
    <div><span class="label">Score :</span> <span id="scoreValue">0</span></div>
    <div><span class="label">Temps :</span> <span id="timerValue">00:00</span></div>
    <div><span class="label">Jokers :</span> <span id="jokersCombinedValue">0 / 0</span></div>
    <div><span class="label">Retours :</span> <span id="undoCount">0</span></div>
  </div>

  <!-- Bloc 4 : Boutons -->
  <div id="topActions">
    <button id="undoBtn" class="main-btn">Retour</button>
    <button id="pauseBtn" class="main-btn">Pause</button>
  </div>

  <!-- Bloc 5 : Meilleur score -->
  <span id="bestScoreTop" class="best-score-info"></span>

<!-- Bloc 6 : Menu Profil (TON CODE ACTUEL - CORRECT) -->
<div id="profileContainer">
  <button id="profileBtn" class="profile-btn">
    <img id="profileAvatar" class="avatar-icon" src="images/avatarDefault.png" alt="Avatar">
    <span id="profilePseudoDisplay">Joueur</span>
  </button>

  <div id="profileDropdown" class="profile-dropdown">
  <div class="profile-info">
    <p><strong>Email:</strong> <span id="profileEmail">email@example.com</span></p>  <!-- ID corrig√© -->
    <p><strong>Joueur depuis:</strong> <span id="profileCreationDate">XX/XX/XXXX</span></p>  <!-- ID corrig√© -->
  </div>
  <div class="profile-actions">
    <button id="editProfileBtn" class="main-btn">Modifier le profil</button>
    <button id="logoutProfileBtn" class="secondary-btn">D√©connexion</button>
  </div>
</div>

</div>

</div>
<!--- Top bar --->

  <!--- Menu burger --->
  <div id="burgerOverlay">
    <button id="burgerReplayBtn" class="main-btn">Rejouer</button>
    <button id="burgerStepBtn" class="main-btn">Pas √† pas</button>
    <button id="burgerHelpBtn" class="main-btn">Aide</button>
    <button id="burgerSoundBtn" class="main-btn">Son : on</button>
    <button id="burgerLeaderboardBtn" class="main-btn">Leaderboard</button>
    <button id="burgerAuthBtn" class="main-btn">Se connecter</button>
  </div>


  <!--- Main area --->
  <div id="mainArea">

    <!--- History --->
    <div id="sidePanel">
      <h2 id="historyTitle">Historique</h2>
      <div id="historyPanel">
        <ul id="historyList"></ul>
      </div>
    </div>

    <!--- Grid --->
    <div id="boardWrapper">
      <div id="canvasContainer" class="board-frame slide-in-premium">

        <!-- Rep√®res horizontaux -->
        <div id="topLabels">
          <span>1</span><span>5</span><span>10</span><span>15</span><span>20</span><span>25</span><span>30</span>
        </div>

        <!-- Rep√®res verticaux -->
        <div id="leftLabels">
          <span>1</span><span>5</span><span>10</span><span>15</span><span>20</span><span>25</span><span>30</span>
        </div>

        <!--- Canvas --->
        <canvas id="gameCanvas" width="600" height="600"></canvas>
        <div id="tutorialBubble"></div>
        <div id="jokerEffectContainer"></div>

      </div>
    </div>

  </div>

</div> <!--- gameContainer --->


  <div id="leaderboardOverlay" class="overlay overlay-center hidden">
  <div class="leaderboard-panel">
    <button id="closeLeaderboardBtn" class="close-btn">‚úï</button>

    <h2 id="leaderboardTitle">Leaderboard</h2>

    <div class="leaderboard-hint">
      Si tu veux voir tes scores, inscris-toi üôÇ
    </div>

    <div id="leaderboardContainer"></div>
  </div>
</div>

  <div id="flashContainer"></div>

<div id="endGameOverlay" class="overlay overlay-center hidden">
  <div id="endGamePanel" class="panel">
    <h2>Partie termin√©e</h2>
    <p id="finalScore"></p>
    <button id="closeEndGame" class="main-btn">OK</button>
  </div>
</div>

<div id="bestScoreOverlay" class="overlay overlay-center hidden">
  <div class="panel">
    <h2>üéâ Nouveau record</h2>
    <div id="bestScoreContent"></div>
    <button id="closeBestScore" class="main-btn">Fermer</button>
  </div>
</div>

<!--- Fen√™tre d'authentification --->
<div id="authOverlay" class="overlay overlay-center hidden">
  <div class="panel">
    <button id="closeAuthBtn" class="close-btn">‚úï</button>

    <h2>Connexion / Inscription</h2>

    <label for="authEmail">Email</label>
    <input type="email" id="authEmail" class="modal-input" />

    <label for="authPassword">Mot de passe</label>
    <input type="password" id="authPassword" class="modal-input" />

    <div class="auth-buttons">
      <button id="signupBtn" class="main-btn">Cr√©er un compte</button>
      <button id="loginBtn" class="main-btn">Se connecter</button>
    </div>
  </div>
</div>

<!--- Fen√™tre pour la cr√©ation de compte --->
<div id="signupModal" class="overlay overlay-center hidden">
  <div class="panel">
    <button id="closeSignupBtn" class="close-btn">‚úï</button>

    <h2>Cr√©er un compte</h2>

    <label for="signupPseudoInput">Pseudo</label>
    <input type="text" id="signupPseudoInput" class="modal-input" />

    <div class="auth-buttons">
      <button id="signupConfirmBtn" class="main-btn">Confirmer</button>
    </div>
  </div>
</div>
 
<!--- Modification Profil --->
<div id="profileModal" class="modal hidden">
  <div class="panel">
    <h2>Modifier mon profil</h2>
    <div class="form-group">
      <label for="profilePseudoInput">Pseudo :</label>
      <input type="text" id="profilePseudoInput" class="form-input" placeholder="Ton pseudo">
    </div>
    <div class="form-group">
      <label for="profileEmailInput">Email :</label>
      <input type="email" id="profileEmailInput" class="form-input" placeholder="Ton email">
    </div>
    <div class="form-group">
      <label for="avatarUpload">Avatar :</label>
      <input type="file" id="avatarUpload" accept="image/*" style="display: none;">
      <button id="changeAvatarBtn" class="secondary-btn">Changer l'avatar</button>
      <img id="profileAvatarPreview" class="avatar-preview" src="images/avatarDefault.png" alt="Aper√ßu avatar">
    </div>
    <button id="changePasswordBtn" class="secondary-btn">Changer le mot de passe</button>
    <div class="modal-actions">
      <button id="saveProfileBtn" class="main-btn">Enregistrer</button>
      <button id="cancelProfileBtn" class="secondary-btn">Annuler</button>
    </div>
  </div>
</div>

<!-- Modale de mot de passe (s√©par√©e) -->
<div id="passwordModal" class="modal hidden">
  <div class="modal-content">
    <h2>Changer le mot de passe</h2>
    <div class="form-group">
      <label for="currentPassword">Mot de passe actuel :</label>
      <input type="password" id="currentPassword" class="form-input">
    </div>
    <div class="form-group">
      <label for="newPassword">Nouveau mot de passe :</label>
      <input type="password" id="newPassword" class="form-input">
    </div>
    <div class="form-group">
      <label for="confirmNewPassword">Confirmer :</label>
      <input type="password" id="confirmNewPassword" class="form-input">
    </div>
    <div id="passwordErrorMessage" class="error-message hidden"></div>
    <div class="modal-actions">
      <button id="validatePasswordBtn" class="main-btn">Valider</button>
      <button id="cancelPasswordBtn" class="secondary-btn">Annuler</button>
    </div>
  </div>
</div>

<!-- Bas de page -->

<footer class="footer">
  <div class="footer-content">
    <div class="logo">
      <img src="images/logo-fmecs.png" alt="Logo Fmecs" class="footer-logo" />
    </div>
    <span class="footer-text">Photo prise par</span>
    <a href="https://www.artmajeur.com/alainaudet" class="footer-link" target="_blank" rel="noopener noreferrer">Alain Audet</a>
    <span class="footer-copyright">
      ¬© 2026 Morpion Solitaire - Croix de Malte. Un jeu Ybial ‚Äì
      <a href="mentions-legales.html" class="footer-link">Mentions l√©gales</a> ‚Äì
      <a href="politique-de-confidentialite.html" class="footer-link">Confidentialit√©</a>
    </span>
  </div>
</footer>
 
<script src="/croix-de-malte/lib/supabase.js"></script>
<script src="game.js"></script>


</body>
</html>